<div class="relative w-64 group">
  <input type="text"
    placeholder="Buscar..."
    class="w-full bg-gray-100 border border-gray-300 rounded-full py-3 px-4 pl-10 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
    (input)="onInput($event)"
    (focus)="showDropdown = results.length > 0"
    (blur)="closeDropdown()"
    [value]="query"
    autocomplete="off"
  />
  <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-5.2-5.2m2.6-6A7.5 7.5 0 1111 3a7.5 7.5 0 017.5 7.5z"></path>
  </svg>

  <div
    *ngIf="showDropdown"
    class="absolute top-full left-0 z-10 mt-3 w-screen max-w-lg rounded-3xl bg-white ring-1 ring-gray-900/5 shadow-lg transition-all duration-300 overflow-y-scroll max-h-96"
  >
    <div class="p-4">
      <div *ngIf="loading" class="text-center text-gray-400 py-2">Buscando...</div>
      <div *ngIf="!loading && results.length === 0" class="text-center text-gray-400 py-2">Sin resultados</div>
      <div *ngFor="let pub of results"
        class="group relative flex items-center gap-x-6 rounded-lg p-4 text-sm hover:bg-gray-50 cursor-pointer"
        (mousedown)="goToPublication(pub.idPublicacion)">
        <div class="flex size-11 flex-none items-center justify-center rounded-lg bg-gray-50 group-hover:bg-white">
          <img [src]="pub.archivos?.[0]?.rutaArchivo || '/assets/img/default-publication.webp'" alt="img" class="object-cover w-10 h-10 rounded" />
        </div>
        <div class="flex-auto">
          <div class="block font-semibold text-gray-600 truncate">{{ pub.titulo }}</div>
          <div class="mt-1 text-gray-500 truncate text-xs">{{ pub.nombreCompleto }} Â· {{ pub.nombreCarrera }}</div>
          <div class="mt-1 text-gray-400 w-sm line-clamp-1 text-xs" [innerHTML]="pub.contenido"></div>
        </div>
      </div>
    </div>
  </div>
</div>
